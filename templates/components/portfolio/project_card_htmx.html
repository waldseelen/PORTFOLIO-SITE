{% load i18n %}
{#
HTMX-Powered Project Card Component
=====================================
Features:
  - Like/Favorite button with HTMX
  - Lazy-loaded project details
  - Smooth skeleton loading
  - Alpine.js micro-interactions

Usage:
  {% include 'components/portfolio/project_card_htmx.html' with project=project_object %}
#}

{% if project %}
<article
    class="project-card group relative"
    x-data="{ liked: false, loading: false, showDetails: false }"
    data-project-id="{{ project.id }}"
>
    {# Glassmorphism Card Container #}
    <div class="relative bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl overflow-hidden
                hover:bg-white/10 hover:border-white/20 hover:shadow-2xl hover:shadow-primary-500/10
                transition-all duration-500 ease-out
                hover:-translate-y-1">

        {# Image Section with Skeleton #}
        <div class="aspect-video relative overflow-hidden bg-gradient-to-br from-gray-800/50 to-gray-900/50">
            {% if project.image %}
            <img
                src="{{ project.image.url }}"
                alt="{{ project.title }}"
                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                loading="lazy"
                x-show="!loading"
                @load="loading = false"
            >
            {# Skeleton while loading #}
            <div
                x-show="loading"
                class="absolute inset-0 bg-gradient-to-r from-gray-800 via-gray-700 to-gray-800 animate-pulse"
            ></div>
            {% else %}
            <div class="absolute inset-0 flex items-center justify-center">
                <svg class="w-16 h-16 text-white/20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
            </div>
            {% endif %}

            {# Status Badge - Floating #}
            {% if project.status %}
            <div class="absolute top-3 left-3">
                <span class="inline-flex items-center gap-1.5 px-3 py-1 text-xs font-medium rounded-full
                            backdrop-blur-md
                            {% if project.status == 'completed' %}bg-emerald-500/20 text-emerald-300 border border-emerald-500/30
                            {% elif project.status == 'development' %}bg-blue-500/20 text-blue-300 border border-blue-500/30
                            {% elif project.status == 'testing' %}bg-amber-500/20 text-amber-300 border border-amber-500/30
                            {% else %}bg-gray-500/20 text-gray-300 border border-gray-500/30{% endif %}">
                    {% if project.status == 'development' %}
                    <span class="w-1.5 h-1.5 rounded-full bg-current animate-pulse"></span>
                    {% else %}
                    <span class="w-1.5 h-1.5 rounded-full bg-current"></span>
                    {% endif %}
                    {{ project.get_status_display|default:"Unknown" }}
                </span>
            </div>
            {% endif %}

            {# HTMX Like Button - Floating #}
            <button
                type="button"
                class="absolute top-3 right-3 p-2.5 rounded-full backdrop-blur-md transition-all duration-300
                       bg-black/30 hover:bg-black/50 border border-white/10 hover:border-white/20
                       hover:scale-110 active:scale-95"
                hx-post="{% url 'portfolio:like_project' project.id %}"
                hx-trigger="click"
                hx-swap="none"
                hx-indicator=".like-indicator-{{ project.id }}"
                @click="liked = !liked"
                :class="{ 'text-rose-400': liked, 'text-white/60 hover:text-white': !liked }"
                aria-label="{% trans 'Like this project' %}"
            >
                <svg
                    class="w-5 h-5 transition-transform duration-300"
                    :class="{ 'scale-125': liked }"
                    :fill="liked ? 'currentColor' : 'none'"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
                <span class="like-indicator-{{ project.id }} htmx-indicator absolute inset-0 flex items-center justify-center">
                    <span class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
                </span>
            </button>
        </div>

        {# Content Section #}
        <div class="p-5 space-y-4">
            {# Title #}
            <h3 class="text-lg font-semibold text-white group-hover:text-primary-400 transition-colors line-clamp-1">
                {{ project.title|default:"Untitled Project" }}
            </h3>

            {# Description - HTMX Lazy Load #}
            <div
                id="project-desc-{{ project.id }}"
                hx-get="{% url 'portfolio:project_description' project.id %}"
                hx-trigger="revealed"
                hx-swap="innerHTML"
            >
                <p class="text-gray-400 text-sm line-clamp-2">
                    {{ project.description|default:"Loading..."|truncatechars:100 }}
                </p>
            </div>

            {# Tech Stack Tags #}
            {% if project.tech_stack %}
            <div class="flex flex-wrap gap-1.5">
                {% for tech in project.tech_stack|slice:":4" %}
                <span class="px-2 py-0.5 text-xs font-medium rounded-full
                            bg-primary-500/10 text-primary-300 border border-primary-500/20
                            hover:bg-primary-500/20 transition-colors cursor-default">
                    {{ tech }}
                </span>
                {% endfor %}
                {% if project.tech_stack|length > 4 %}
                <span class="px-2 py-0.5 text-xs font-medium rounded-full
                            bg-gray-500/10 text-gray-400 border border-gray-500/20">
                    +{{ project.tech_stack|length|add:"-4" }}
                </span>
                {% endif %}
            </div>
            {% endif %}

            {# Progress Bar #}
            {% if project.progress_percentage %}
            <div class="space-y-1.5">
                <div class="flex justify-between items-center text-xs">
                    <span class="text-gray-500">{% trans 'Progress' %}</span>
                    <span class="text-gray-400 font-medium">{{ project.progress_percentage }}%</span>
                </div>
                <div class="h-1.5 bg-gray-800 rounded-full overflow-hidden">
                    <div
                        class="h-full rounded-full transition-all duration-1000 ease-out
                               {% if project.progress_percentage >= 100 %}bg-gradient-to-r from-emerald-500 to-emerald-400
                               {% elif project.progress_percentage >= 50 %}bg-gradient-to-r from-blue-500 to-blue-400
                               {% else %}bg-gradient-to-r from-amber-500 to-amber-400{% endif %}"
                        style="width: {{ project.progress_percentage }}%"
                    ></div>
                </div>
            </div>
            {% endif %}

            {# Actions Row #}
            <div class="flex items-center justify-between pt-2 border-t border-white/5">
                {# External Links #}
                <div class="flex items-center gap-2">
                    {% if project.github_url %}
                    <a
                        href="{{ project.github_url }}"
                        target="_blank"
                        rel="noopener noreferrer"
                        class="p-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white
                               transition-all duration-200 hover:scale-105"
                        aria-label="{% trans 'View on GitHub' %}"
                    >
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
                        </svg>
                    </a>
                    {% endif %}
                    {% if project.live_url %}
                    <a
                        href="{{ project.live_url }}"
                        target="_blank"
                        rel="noopener noreferrer"
                        class="p-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-400 hover:text-primary-400
                               transition-all duration-200 hover:scale-105"
                        aria-label="{% trans 'View live site' %}"
                    >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                        </svg>
                    </a>
                    {% endif %}
                </div>

                {# Details Button with HTMX #}
                {% if project.slug %}
                <a
                    href="{% url 'main:project_detail' project.slug %}"
                    class="magnetic-button inline-flex items-center gap-2 px-4 py-2
                           bg-gradient-to-r from-primary-600 to-primary-500
                           hover:from-primary-500 hover:to-primary-400
                           text-white text-sm font-medium rounded-lg
                           transition-all duration-300 hover:shadow-lg hover:shadow-primary-500/25
                           hover:scale-105 active:scale-95"
                    hx-boost="true"
                    hx-target="#main-content"
                    hx-swap="innerHTML transition:true"
                >
                    {% trans 'Explore' %}
                    <svg class="w-4 h-4 transition-transform group-hover:translate-x-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</article>
{% else %}
{# Empty State Skeleton #}
<div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl overflow-hidden animate-pulse">
    <div class="aspect-video bg-gradient-to-r from-gray-800 via-gray-700 to-gray-800"></div>
    <div class="p-5 space-y-4">
        <div class="h-5 bg-gray-700 rounded w-3/4"></div>
        <div class="space-y-2">
            <div class="h-3 bg-gray-700 rounded w-full"></div>
            <div class="h-3 bg-gray-700 rounded w-5/6"></div>
        </div>
        <div class="flex gap-2">
            <div class="h-6 bg-gray-700 rounded-full w-16"></div>
            <div class="h-6 bg-gray-700 rounded-full w-20"></div>
        </div>
    </div>
</div>
{% endif %}
